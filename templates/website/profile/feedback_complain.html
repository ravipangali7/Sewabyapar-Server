{% extends 'website/base.html' %}

{% block title %}Feedback/Complain - {% if settings %}{{ settings.name }}{% else %}Website{% endif %}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 lg:py-12">
    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-6 sm:mb-8">Feedback / Complain</h1>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
        <!-- Form -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-xl shadow-lg p-6 sticky top-24">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-6">Submit {{ feedback_type|title }}</h2>
                <form method="post" action="{% url 'website:feedback_complain' %}" class="space-y-4">
                    {% csrf_token %}
                    <input type="hidden" name="type" value="{{ feedback_type }}">
                    <div>
                        <label for="subject" class="block text-sm font-semibold text-gray-700 mb-2">Subject</label>
                        <input type="text" id="subject" name="subject" required 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-lg">
                    </div>

                    <div>
                        <label for="message" class="block text-sm font-semibold text-gray-700 mb-2">Message</label>
                        <textarea id="message" name="message" rows="5" required 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-lg"></textarea>
                    </div>

                    <button type="submit" class="w-full bg-red-600 text-white px-6 py-3.5 rounded-xl font-semibold hover:bg-red-700 transition-all shadow-lg hover:shadow-xl min-h-[48px]">
                        Submit
                    </button>
                </form>
            </div>
        </div>

        <!-- Previous Feedbacks -->
        <div class="lg:col-span-2">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">My {{ feedback_type|title }}s</h2>
            {% if user_feedbacks %}
            <div class="space-y-4">
                {% for feedback in user_feedbacks %}
                <div class="bg-white rounded-xl shadow-md p-5 sm:p-6 hover:shadow-lg transition-shadow">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3 mb-4">
                        <div class="flex-1">
                            <h3 class="text-lg sm:text-xl font-semibold text-gray-900 mb-1">{{ feedback.subject }}</h3>
                            <p class="text-gray-600 text-sm">{{ feedback.created_at|date:"F d, Y" }}</p>
                        </div>
                        <span class="px-3 py-1.5 rounded-full text-xs sm:text-sm font-semibold 
                            {% if feedback.status == 'resolved' %}bg-green-100 text-green-800
                            {% elif feedback.status == 'in_progress' %}bg-blue-100 text-blue-800
                            {% elif feedback.status == 'closed' %}bg-gray-100 text-gray-800
                            {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                            {{ feedback.get_status_display }}
                        </span>
                    </div>
                    <p class="text-gray-700 mb-4 line-clamp-2">{{ feedback.message }}</p>
                    <a href="{% url 'website:feedback_detail' feedback.id %}" class="inline-flex items-center text-red-600 hover:text-red-700 font-semibold transition-colors min-h-[44px]">
                        View Details
                        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </a>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if user_feedbacks.has_other_pages %}
            <div class="mt-8 sm:mt-12 flex justify-center">
                <nav class="flex items-center space-x-2">
                    {% if user_feedbacks.has_previous %}
                    <a href="?page={{ user_feedbacks.previous_page_number }}" 
                        class="px-4 py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors min-h-[44px] flex items-center">
                        Previous
                    </a>
                    {% endif %}
                    <span class="px-4 py-2.5 bg-gray-100 text-gray-700 rounded-lg font-medium min-h-[44px] flex items-center">
                        Page {{ user_feedbacks.number }} of {{ user_feedbacks.paginator.num_pages }}
                    </span>
                    {% if user_feedbacks.has_next %}
                    <a href="?page={{ user_feedbacks.next_page_number }}" 
                        class="px-4 py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors min-h-[44px] flex items-center">
                        Next
                    </a>
                    {% endif %}
                </nav>
            </div>
            {% endif %}
            {% else %}
            <div class="text-center py-12 bg-white rounded-xl shadow-md">
                <svg class="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                </svg>
                <p class="text-gray-600">No {{ feedback_type }}s submitted yet.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
